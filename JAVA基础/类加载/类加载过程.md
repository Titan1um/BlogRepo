# 类加载过程

加载 -> 连接(验证,准备,解析) -> 初始化 -> 使用 -> 卸载

<br>

## 加载
在这个阶段jvm主要完成三件事：

- 通过类的全限定名来获取其定义的二进制字节流
- 将这个字节流所代表的静态存储结构转化为方法区运行时数据结构
- 在堆中生成一个代表这个类的class对象，作为方法区中这些数据访问入口 \

相对于类加载的其他阶段，加载阶段是可控性最强的阶段，因为我们可以使用系统的类加载器加载，也可以使用自定义的类加载器加载。

<br>

## 连接
其中验证过程详解: [link](https://blog.csdn.net/qf2019/article/details/116016791)
 > 验证： 主要作用就是确保被加载的类的正确性，也是连接阶段的第一步。即判断加载好的class文件不能对jvm有危害，它主要完成四个方面的验证
 - 文件格式验证：验证.class文件字节流是否符合class文件的格式规范，并且能够被当前版本的虚拟机处理。这里面主要对魔数、主版本号、常量池等等的校验。
 - 元数据验证：主要是对字节码描述的信息进行语义分析，以保证其描述的信息符合java语言规范的要求，比如说验证这个类是不是有父类，类中的字段方法是不是和父类冲突等等。
 - 字节码验证：这是整个验证过程最复杂的阶段，主要是通过数据流和控制流分析，确定程序语义是合法的、符合逻辑的。在元数据验证阶段对数据类型做出验证后，这个阶段主要对类的方法做出分析，保证类的方法在运行时不会做出威海虚拟机安全的事。
 - 符号引用验证：它是验证的最后一个阶段，发生在虚拟机将符号引用转化为直接引用的时候。主要是对类自身以外的信息进行校验。目的是确保解析动作能够完成。

 对整个类加载机制而言，验证阶段是一个很重要但是非必需的阶段，如果我们的代码能够确保没有问题，那么我们就没有必要去验证，毕竟验证需要花费一定的的时间。当然我们可以使用-Xverfity:none来关闭大部分的验证。

 > 准备     主要为类变量分配内存并设置初始值。这些内存都在方法区分配。在这个阶段我们需要注意两类变量和初始值这两个关键词:

    类变量（static）会分配内存，但是实例变量不会，实例变量主要随着对象的实例化一块分配到java堆中.这里的初始值指的是**数据类型默认值**，而不是代码中被显示赋予的值

 > 解析:主要是jvm将常量池中的符号引用转化为直接引用的过程。 
- 符号引用：以一组符号来描述所引用的目标，可以是任何形式的字面量，只要是能无歧义的定位到目标就好，就好比在工作中，可以用cherry（你的英文名字）代表你，也可用工号来代表你，但无论任何方式这些都只是一个代号（符号），这个代号指向你（符号引用） \
- 直接引用：直接引用是可以指向目标的指针、相对偏移量或者是一个能直接或间接定位到目标的句柄。和虚拟机实现的内存有关，不同的虚拟机直接引用一般不同。\

 解析动作主要针对类或接口、字段、类方法、接口方法、方法类型、方法句柄和调用点限定符7类符号引用进行。

<br>

## 初始化

<br>

## 使用

<br>

## 卸载

<br>

> 参考\
 [JAVA类加载机制详解](https://blog.csdn.net/qf2019/article/details/116016791) \
 [侧重讲了加载](https://www.cnblogs.com/xdouby/p/5829423.html)
 
 <br>

 <I>本篇无个人理解,均为知识点摘录